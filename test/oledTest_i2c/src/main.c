#define SSD1306_128X64

#include "ch32fun.h"
#include <stdio.h>
#include "ssd1306_i2c.h"
#include "ssd1306.h"

// Converted with https://javl.github.io/image2cpp/
// Draw mode: Horizontal, 1 bit per pixel
static const uint8_t BUNCHO[] =
    {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x01, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xf8, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x1e, 0x1f, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x3f, 0x8f, 0x80, 0x00,
        0x00, 0x00, 0x00, 0xf0, 0x71, 0xc7, 0xe0, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x60, 0xc6, 0xf0, 0x00,
        0x00, 0x00, 0x01, 0xc0, 0x60, 0xc6, 0x38, 0x00, 0x00, 0x00, 0x03, 0x80, 0x60, 0xc6, 0x1c, 0x00,
        0x00, 0x00, 0x07, 0x00, 0x71, 0xce, 0x0e, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x3f, 0x8c, 0x06, 0x00,
        0x00, 0x00, 0x0c, 0x00, 0x1f, 0x0c, 0x07, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xc0, 0x0c, 0x3f, 0x80,
        0x00, 0x00, 0x3f, 0xff, 0xfe, 0x0f, 0xff, 0x80, 0x00, 0x00, 0x3e, 0x00, 0x7f, 0xff, 0xf1, 0xc0,
        0x00, 0x00, 0x70, 0x00, 0x03, 0xfe, 0x07, 0x80, 0x00, 0x00, 0x78, 0x00, 0x00, 0x38, 0x1f, 0x00,
        0x00, 0x00, 0xfe, 0x00, 0x00, 0x38, 0x7c, 0x00, 0x00, 0x00, 0xef, 0x00, 0x00, 0x3b, 0xf0, 0x00,
        0x00, 0x01, 0xd7, 0xc0, 0x00, 0x3f, 0xc0, 0x00, 0x00, 0x01, 0xab, 0xf0, 0x00, 0x3e, 0x00, 0x00,
        0x00, 0x01, 0xd5, 0x7e, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x03, 0xaa, 0xaf, 0xff, 0xfc, 0x00, 0x00,
        0x00, 0x03, 0x55, 0x55, 0xff, 0xde, 0x00, 0x00, 0x00, 0x03, 0xaa, 0xaa, 0xaa, 0xae, 0x00, 0x00,
        0x00, 0x07, 0x55, 0x55, 0x55, 0x57, 0x00, 0x00, 0x00, 0x06, 0xaa, 0xaa, 0xaa, 0xab, 0x00, 0x00,
        0x00, 0x0f, 0x55, 0x55, 0x55, 0x57, 0x00, 0x00, 0x00, 0x0e, 0xaa, 0xaa, 0xaa, 0xab, 0x80, 0x00,
        0x00, 0x0d, 0x55, 0x55, 0x55, 0x55, 0x80, 0x00, 0x00, 0x1e, 0xaa, 0xaa, 0xaa, 0xab, 0x80, 0x00,
        0x00, 0x1d, 0x55, 0x55, 0x55, 0x55, 0x80, 0x00, 0x00, 0x1a, 0xaa, 0xaa, 0xaa, 0xab, 0x80, 0x00,
        0x00, 0x1d, 0x55, 0x55, 0x55, 0x55, 0x80, 0x00, 0x00, 0x3a, 0xaa, 0xaa, 0xaa, 0xab, 0x80, 0x00,
        0x00, 0x35, 0x55, 0x55, 0x55, 0x55, 0x80, 0x00, 0x00, 0x3a, 0xaa, 0xaa, 0xaa, 0xab, 0x80, 0x00,
        0x00, 0x35, 0x55, 0x55, 0x55, 0x55, 0x80, 0x00, 0x00, 0x3a, 0xaa, 0xaa, 0xaa, 0xab, 0x80, 0x00,
        0x00, 0x35, 0x55, 0x55, 0x55, 0x57, 0x00, 0x00, 0x00, 0x3a, 0xaa, 0xaa, 0xaa, 0xab, 0x00, 0x00,
        0x00, 0x35, 0x55, 0x55, 0x55, 0x57, 0x00, 0x00, 0x00, 0x3a, 0xaa, 0xaa, 0xaa, 0xae, 0x00, 0x00,
        0x00, 0x35, 0x55, 0x55, 0x55, 0x56, 0x00, 0x00, 0x00, 0x3a, 0xaa, 0xaa, 0xaa, 0xae, 0x00, 0x00,
        0x00, 0x35, 0x55, 0x55, 0x55, 0x5c, 0x00, 0x00, 0x00, 0x1a, 0xaa, 0xaa, 0xaa, 0xbc, 0x00, 0x00,
        0x00, 0x0d, 0x55, 0x55, 0x55, 0x58, 0x00, 0x00, 0x00, 0x0e, 0xaa, 0xaa, 0xaa, 0xb8, 0x00, 0x00,
        0x00, 0x07, 0x55, 0x55, 0x55, 0x70, 0x00, 0x00, 0x00, 0x03, 0xaa, 0xaa, 0xaa, 0xe0, 0x00, 0x00,
        0x00, 0x01, 0xd5, 0x55, 0x55, 0xff, 0xe0, 0x00, 0x00, 0x01, 0xff, 0x2a, 0xaf, 0xff, 0xff, 0x00,
        0x00, 0x3f, 0xff, 0xff, 0xff, 0x00, 0x3f, 0xc0, 0x07, 0xff, 0x81, 0xff, 0xf8, 0x00, 0x01, 0xe0,
        0x07, 0xe0, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x40, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0,
        0x0f, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x70, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

int main()
{
  SystemInit();

  Delay_Ms(100);
  printf("init\r\n");

  Delay_Ms(100);
  // I2Cの初期化
  if (!ssd1306_i2c_init())
  {
    // OLEDの初期化
    ssd1306_init();
    while (1)
    {
      // バッファのクリア
      ssd1306_setbuf(0);

      // 画像の描画
      ssd1306_drawImage(0, 0, BUNCHO, 64, 64, 0);
      // テキストの描画
      ssd1306_drawstr(80, 20, "@74th", 1);
      ssd1306_drawstr(80, 34, "CH32V", 1);
      ssd1306_drawstr(96, 44, "003", 1);
      // 矩形の描画
      ssd1306_drawRect(75, 15, 128 - 70 - 5, 45, 1);

      // バッファからOLEDに描画
      ssd1306_refresh();

      Delay_Ms(2000);
    }
  }
  else
    printf("failed to initialize OLED.\r\n");

  while (1)
    ;
}
